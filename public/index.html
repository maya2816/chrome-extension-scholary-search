<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScholarSearch</title>
    <!-- Add Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Source+Sans+Pro:wght@300;400;600&family=Crimson+Pro:wght@600&display=swap" rel="stylesheet">
</head>

<!-- ----------------------------------------------------------------------------- -->
<!-- ----------------------------- Style: Custom CSS ----------------------------- -->
<!-- ----------------------------------------------------------------------------- -->
<style>
    /* Style: Body */
    body {
        background-color: #e8e7e7;
        font-family: 'Source Sans Pro', sans-serif;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
        color: #545454;
    }

    /* Style: Container */
    .container {
        width: 100%;
        height: 100vh;
        padding: 2.5rem 1.8rem;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        max-width: 600px;
        margin: 0 auto;
    }
    
    /* Style: Header */
    h1 {
        font-family: 'Cormorant Garamond', serif;
        font-size: 42px;
        font-weight: 600;
        margin-bottom: 3rem;
        color: #333;
        text-align: center;
        letter-spacing: 1px;
    }

    /* Style: Form Section */
    .form-section {
        margin-bottom: 2rem;
    }

    /* Style: Label */
    label {
        display: block;
        margin-bottom: 10px;
        font-weight: 500;
        font-size: 15px;
        letter-spacing: 0.3px;
        color: #666;
    }

    /* Style: Label's Input */
    input[type="text"] {
        width: 100%;
        padding: 14px 16px;
        border: 1px solid #c0c0c0;
        border-radius: 10px;
        background-color: #f9fafb;
        font-family: 'Source Sans Pro', sans-serif;
        font-size: 15px;
        color: #6b7280;
        box-sizing: border-box;
        transition: border-color 0.2s ease;
    }

    input[type="text"]:focus {
        outline: none;
        border-color: #666;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    /* Style: Search Button */
    .button-main {
        padding: 16px;
        background-color: #6e6b6b;
        color: white;
        font-family: 'Source Sans Pro', sans-serif;
        font-size: 15px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        margin-top: 2.5rem;
        margin-bottom: 20px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-transform: uppercase;
        letter-spacing: 1.5px;
    }

    .button-main:hover {
        background-color: #545454;
        transform: translateY(-1px);
        box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
    }

    /* Style: Help Button */
    .help-btn {
        position: absolute;
        top: 16px;
        right: 16px;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        background-color: #f0f0f0;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #d1d5db;
        font-family: 'Crimson Pro', serif;
        font-weight: 600;
        color: #4b5563;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .help-btn:hover {
        background-color: #e5e5e5;
        transform: scale(1.05);
    }

    /* Style: Footer */
    .footer {
        text-align: center;
        margin-top: auto;
        font-size: 13px;
        color: #888;
        font-weight: 300;
        letter-spacing: 0.5px;
    }

    /* Style: Modal */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .modal.show {
        display: block;
        opacity: 1;
    }

    .modal-content {
        position: relative;
        background-color: #fefefe;
        margin: 15% auto;
        padding: 2rem;
        border-radius: 12px;
        width: 80%;
        max-width: 500px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transform: translateY(-20px);
        transition: transform 0.3s ease;
    }

    .modal.show .modal-content {
        transform: translateY(0);
    }

    .close-modal {
        position: absolute;
        right: 1rem;
        top: 1rem;
        font-size: 20px;
        font-weight: bold;
        color: #666;
        cursor: pointer;
        padding: 5px 10px;
        border-radius: 4px;
    }

    .close-modal:hover {
        background-color: #f0f0f0;
    }

    .modal-title {
        font-family: 'Cormorant Garamond', serif;
        font-size: 24px;
        margin-bottom: 1rem;
        color: #333;
    }

    .modal-text {
        font-family: 'Source Sans Pro', sans-serif;
        font-size: 15px;
        line-height: 1.6;
        color: #666;
    }

    /* Loading Window */
    .loading-window {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background-color: #f8f9fa;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .loading-window.show {
        opacity: 1;
        visibility: visible;
    }

    /* Main Content Transition */
    #mainContent {
        opacity: 1;
        visibility: visible;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    #mainContent.hide {
        opacity: 0;
        visibility: hidden;
    }

    /* Loading Text Style */
    .loading-window h2 {
        font-family: 'Source Sans Pro', sans-serif;
        font-size: 24px;
        color: #333;
        margin-bottom: 20px;
    }
</style>
<!-- ----------------------------------------------------------------------------- -->
<!-- ----------------------------------------------------------------------------- -->


<!-- ----------------------------------------------------------------------------- -->
<!-- ----------------------------- Body: HTML ------------------------------------ -->
<!-- ----------------------------------------------------------------------------- -->
<body>
    <!-- Loading Window -->
    <div id="loadingWindow" class="loading-window">
        <h2>Finding relevant papers...</h2>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeModal">&times;</span>
            <h2 class="modal-title">About ScholarSearch</h2>
            <div class="modal-text">
                <!-- TODO: Add actual help content -->
                <p>Placeholder for help content. This will be replaced with actual documentation.</p>
            </div>
        </div>
    </div>

    <!-- Help Button -->
    <div class="help-btn" id="openModal">?</div>

    <!-- UI Preview while React is loading -->
    <div class="container" id="fallbackUI">
        <!-- ---- Title ---- -->
        <h1>ScholarSearch</h1>
    
        <!-- ---- Input: Research Query ---- -->
        <div class="form-section">
            <label for="query">Research Query</label>
            <input 
                type="text"
                id="query"
                placeholder="e.g., machine learning applications"
                onchange="handleQueryChange(event)"
            />
        </div>
    
        <!-- ---- Input: Keywords ---- -->
        <div class="form-section">
            <label for="keywords">Keywords</label>
            <input 
                type="text" 
                id="keywords" 
                placeholder="e.g., neural networks, predictive analysis" 
                onchange="handleKeywordsChange(event)"
            />
        </div>
    
        <!-- ---- Button: Find Papers ---- -->
        <button class="button-main" onclick="handleSearch()">FIND PAPERS</button>

        <!-- ---- Footer ---- -->
        <div class="footer">Â© 2025 ScholarSearch</div>

        <!-- ---- React App Entry Point ---- -->
        <div id="root" style="display:none;"></div>
        <script>
            // Wait for DOM to be fully loaded
            document.addEventListener('DOMContentLoaded', function() {
                // Get modal elements
                const modal = document.getElementById('helpModal');
                const openBtn = document.getElementById('openModal');
                const closeBtn = document.getElementById('closeModal');

                // Open modal function
                function openModal() {
                    modal.classList.add('show');
                    console.log('Opening modal'); // Debug log
                }

                // Close modal function
                function closeModal() {
                    modal.classList.remove('show');
                    console.log('Closing modal'); // Debug log
                }

                // Event listeners
                openBtn.addEventListener('click', openModal);
                closeBtn.addEventListener('click', closeModal);

                // Close on outside click
                window.addEventListener('click', function(event) {
                    if (event.target === modal) {
                        closeModal();
                    }
                });

                // Close on escape key
                document.addEventListener('keydown', function(event) {
                    if (event.key === 'Escape' && modal.classList.contains('show')) {
                        closeModal();
                    }
                });
            });

            // Form handling functions
            let searchData = {
                query: '',
                keywords: ''
            };

            function handleQueryChange(event) {
                searchData.query = event.target.value;
                console.log('Query updated:', searchData.query);
            }

            function handleKeywordsChange(event) {
                searchData.keywords = event.target.value;
                console.log('Keywords updated:', searchData.keywords);
            }

            function handleSearch() {
                console.log('Search button clicked');
                const mainContent = document.getElementById('mainContent');
                const loadingWindow = document.getElementById('loadingWindow');
                
                // Show loading window
                mainContent.classList.add('hide');
                loadingWindow.classList.add('show');
                
                // Send message to background script
                chrome.runtime.sendMessage({
                    action: 'performSearch',
                    searchData: searchData
                }, (response) => {
                    console.log('Received response:', response);
                    
                    // Hide loading window
                    loadingWindow.classList.remove('show');
                    mainContent.classList.remove('hide');
                    
                    if (response && response.success) {
                        // Handle successful search
                        console.log('Search completed successfully:', response.data);
                        // TODO: Update UI with search results
                    } else {
                        // Handle error
                        console.error('Search failed:', response?.message || 'Unknown error');
                        // TODO: Show error message to user
                    }
                });
            }

            // React integration check
            window.addEventListener('DOMContentLoaded', () => {
                const checkReact = setInterval(() => {
                    if (document.getElementById('root').children.length > 0) {
                        document.getElementById('fallbackUI').style.display = 'none';
                        document.getElementById('root').style.display = 'block';
                        clearInterval(checkReact);
                    }
                }, 100);
            });
        </script>
        <script type="module" src="/src/index.tsx"></script>
    </div>
</body>
</html>
